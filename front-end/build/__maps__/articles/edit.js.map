{"version":3,"sources":["edit.js"],"names":["$content","$","trumbowyg","btnsDef","image","dropdown","ico","btns","upload","serverPath","fileFieldName","urlPropertyName","getContent","$el","data","$ed","html","api","action","editForm","payload","tags","split","content","mentions","submitted","$button","$progress","$fileBox","$form","tmpl","$noFiles","initialAPI","undefined","get","ok","tagator","autocomplete","map","item","name","showAllOptionsOnFocus","nicknames","allowAutocompleteOnly"],"mappings":";;;;;;;;;;;;;AAMA,QAAIA,WAAWC,EAAE,UAAF,EAAcC,SAAd,CAAwB;AACnCC,iBAAS;AACL;AACAC,mBAAO;AACHC,0BAAU,CAAC,aAAD,EAAgB,QAAhB,EAA0B,QAA1B,EAAoC,SAApC,CADP;AAEHC,qBAAK;AAFF;AAFF,SAD0B;AAQnCC,cAAM,CACF,CAAC,UAAD,CADE,EAEF,CAAC,MAAD,EAAS,MAAT,CAFE,EAGF,CAAC,YAAD,CAHE,EAIF,eAJE,EAKF,CAAC,MAAD,CALE,EAMF,CAAC,OAAD,CANE,EAOF,gBAPE,EAQF,cARE,EASF,CAAC,WAAD,EAAc,WAAd,CATE,EAUF,CAAC,cAAD,CAVE,EAWF,CAAC,gBAAD,CAXE,EAYF,CAAC,YAAD,CAZE,CAR6B;AAsBnC,mBAAW;AACPC,oBAAQ;AACJC,4BAAY,eADR;AAEJC,+BAAe,OAFX;AAGJC,iCAAiB;AAHb;AADD;AAtBwB,KAAxB,CAAf;;AA+BA,QAAMC,aAAa,SAAbA,UAAa;AAAA,eAAOC,IAAIC,IAAJ,CAAS,WAAT,EAAsBC,GAAtB,CAA0BC,IAA1B,EAAP;AAAA,KAAnB;AACA,QAAMC,MAAM,yEAA4C,gBAAxD;AACA,QAAMC,SAAS,wBAAY,OAAZ,GAAsB,MAArC;;AAEA,QAAIC,WAAW,mBAAS,YAAT,EAAuBF,GAAvB,EAA4BC,MAA5B,EACVE,OADU,CACF;AAAA,eACLN,KAAKO,IAAL,GAAY,CAACP,KAAKO,IAAN,GAAa,EAAb,GAAkBP,KAAKO,IAAL,CAAUC,KAAV,CAAgB,GAAhB,CADzB;AAAA,KADE,EAGTF,OAHS,CAGD;AAAA,eACNN,KAAKS,OAAL,GAAeX,WAAWZ,QAAX,CADT;AAAA,KAHC,EAKToB,OALS,CAKD;AAAA,eACNN,KAAKU,QAAL,GAAgBV,KAAKU,QAAL,CAAcF,KAAd,CAAoB,GAApB,CADV;AAAA,KALC,EAOTG,SAPS,CAOC;AAAA,eAAW,CAAX;AAAA;AACR;AARO,KAAf;;AAWA;;AAIA,4BAAW;AACPC,iBAAS,cADF;AAEPC,mBAAW,yBAFJ;AAGPC,kBAAU,WAHH;AAIPC,eAAO,YAJA;AAKPC,cAAM,WALC;AAMPC,kBAAU,WANH;AAOPC,oBAAY,qFAAuDC;AAP5D,KAAX;;AAUA;;AAEA,uBAAQ,YAAR,EAAsBC,GAAtB,GACKC,EADL,CACQ,gBAAQ;AACRlC,UAAE,OAAF,EAAWmC,OAAX,CAAmB;AACfC,0BAAchB,KAAKiB,GAAL,CAAS;AAAA,uBAAQC,KAAKC,IAAb;AAAA,aAAT,CADC;AAEfC,mCAAuB;AAFR,SAAnB;AAIH,KANL;;AAQA,QAAI,sBAAJ,EAAgB;AACZ,2BAAQ,sBAAR,EAAgCP,GAAhC,GACKC,EADL,CACQ,qBAAa;AACblC,cAAE,WAAF,EAAemC,OAAf,CAAuB;AACnBC,8BAAcK,SADK;AAEnBD,uCAAuB,IAFJ;AAGnBE,uCAAuB;AAHJ,aAAvB;AAKH,SAPL;AAQH","file":"../../articles/edit.js","sourcesContent":["import 'trumbowyg'\nimport Form from 'util/form'\nimport { articleId } from 'page-config'\nimport 'tagator'\nimport API from 'util/rest'\n\nlet $content = $('#content').trumbowyg({\n    btnsDef: {\n        // Customizables dropdowns\n        image: {\n            dropdown: ['insertImage', 'upload', 'base64', 'noembed'],\n            ico: 'insertImage'\n        }\n    },\n    btns: [\n        ['viewHTML'],\n        ['undo', 'redo'],\n        ['formatting'],\n        'btnGrp-design',\n        ['link'],\n        ['image'],\n        'btnGrp-justify',\n        'btnGrp-lists',\n        ['foreColor', 'backColor'],\n        ['preformatted'],\n        ['horizontalRule'],\n        ['fullscreen']\n    ],\n    'plugins': {\n        upload: {\n            serverPath: '/files/image/',\n            fileFieldName: 'image',\n            urlPropertyName: 'url'\n        }\n    }\n})\n\nconst getContent = $el => $el.data('trumbowyg').$ed.html()\nconst api = articleId ? `/api/articles/${articleId}/` : '/api/articles/'\nconst action = articleId ? 'patch' : 'post'\n\nlet editForm = new Form('#edit-form', api, action)\n    .payload(data =>\n        data.tags = !data.tags ? [] : data.tags.split(',')\n    ).payload(data =>\n        data.content = getContent($content)\n    ).payload(data =>\n        data.mentions = data.mentions.split(',')\n    ).submitted(response =>0\n        //response.ok(({ url }) => location.href = url)\n    )\n\n// File Uploads\n\nimport { Upload } from 'util/attachments'\n\nnew Upload({\n    $button: '#attachments',\n    $progress: '.progress .progress-bar',\n    $fileBox: '#file-box',\n    $form: '#edit-form',\n    tmpl: 'file-item',\n    $noFiles: '.no-files',\n    initialAPI: articleId ? `/api/articles/${articleId}/attachments/`: undefined\n})\n\n// Tagify\n\nnew API('/api/tags/').get()\n    .ok(tags => {\n        $('#tags').tagator({\n            autocomplete: tags.map(item => item.name),\n            showAllOptionsOnFocus: true\n        })\n    })\n\nif (!articleId) {\n    new API('/api/user_nicknames/').get()\n        .ok(nicknames => {\n            $('#mentions').tagator({\n                autocomplete: nicknames,\n                showAllOptionsOnFocus: true,\n                allowAutocompleteOnly: true\n            })\n        })\n}\n"]}