{"version":3,"sources":["detail.js"],"names":["list","tmpl","verbatim","setReplyTo","data","$","remove","attr","type","name","value","id","prependTo","nickname","removeClass","location","href","clearReplyTo","addClass","click","$commentBox","commentAPI","articleId","commentList","List","$box","api","$loadMore","results","forEach","item","can_reply","authenticated","author","userId","on","submitted","response","ok","prepend","bind","action","post","parent","confirm","delete","alert"],"mappings":";;;;;;;QAEYA,I;;;;;;QAGAC,I;;;;;;;;;;;;;;;;;;;;;;;;;AAEZA,SAAKC,QAAL;;AAEA,aAASC,UAAT,CAAqBC,IAArB,EAA2B;AACvBC,UAAE,oCAAF,EAAwCC,MAAxC;AACAD,UAAE,SAAF,EACKE,IADL,CACU,EAAEC,MAAM,QAAR,EAAkBC,MAAM,UAAxB,EAAoCC,OAAON,KAAKO,EAAhD,EADV,EAEKC,SAFL,CAEe,eAFf;AAGAP,UAAE,wBAAF,EAA4BE,IAA5B,CAAiC,aAAjC,QAAoDH,KAAKS,QAAzD;AACAR,UAAE,eAAF,EAAmBS,WAAnB,CAA+B,cAA/B;AACAC,iBAASC,IAAT,GAAgB,gBAAhB;AACH;;AAED,aAASC,YAAT,GAAyB;AACrBZ,UAAE,oCAAF,EAAwCC,MAAxC;AACAD,UAAE,eAAF,EAAmBa,QAAnB,CAA4B,cAA5B;AACAb,UAAE,wBAAF,EAA4BE,IAA5B,CAAiC,aAAjC;AACH;;AAEDF,MAAE,eAAF,EAAmBc,KAAnB,CAAyBF,YAAzB;;AAEA,QAAMG,cAAcf,EAAE,cAAF,CAApB;;AAEA,QAAMgB,aAAa,sCAAyB,qBAAWC,SAApC,gBAAnB;;AAEA,QAAIC,cAAc,IAAIvB,KAAKwB,IAAT,CAAc;AAC5BC,cAAML,WADsB;AAE5BM,aAAKL,UAFuB;AAG5BpB,cAAM,cAHsB;AAI5B0B,mBAAW;AAJiB,KAAd,EAKfC,OALe,CAKP;AAAA,eAAWA,QAAQC,OAAR,CAAgB,gBAAQ;AAC1CC,iBAAKC,SAAL,GAAiB,mBAAKC,aAAL,IAAsBF,KAAKG,MAAL,CAAYtB,EAAZ,KAAmB,mBAAKuB,MAA/D;AACH,SAFqB,CAAX;AAAA,KALO,CAAlB;;AASAd,gBAAYe,EAAZ,CAAe,OAAf,EAAwB,YAAxB,EAAsC,YAAY;AAC9ChC,mBAAWE,EAAE,IAAF,EAAQD,IAAR,EAAX;AACH,KAFD;;AAIA,uBAAS,eAAT,EAA0BiB,UAA1B,EAAsC,MAAtC,EACKe,SADL,CACe,oBAAY;AACnBC,iBAASC,EAAT,CAAYf,YAAYgB,OAAZ,CAAoBC,IAApB,CAAyBjB,WAAzB,CAAZ,EACKe,EADL,CACQrB,YADR;AAEH,KAJL;;AAMA;;AAEAZ,MAAE,kBAAF,EAAsB8B,EAAtB,CAAyB,OAAzB,EAAkC,YAAY;AAAA;;AAC1C,YAAIM,SAASpC,EAAE,IAAF,EAAQE,IAAR,CAAa,IAAb,CAAb;AACA,8CAAyB,qBAAWe,SAApC,SAAiDmB,MAAjD,QACKC,IADL,GACYJ,EADZ,CACe,YAAM;AACbjC,qBAAQsC,MAAR,GAAiBrC,MAAjB;AACH,SAHL;AAIH,KAND;;AAQAD,MAAE,iBAAF,EAAqBc,KAArB,CAA2B,YAAM;AAC7B,YAAIyB,QAAQ,yBAAR,CAAJ,EAAwC;AACpC,kDAAyB,qBAAWtB,SAApC,QAAkDuB,MAAlD,GACKP,EADL,CACQ,YAAM;AACNQ,sBAAM,IAAN;AACA/B,yBAASC,IAAT,GAAgB,iBAAhB;AACH,aAJL;AAKH;AACJ,KARD","file":"../../articles/detail.js","sourcesContent":["import Form from 'util/form'\nimport API from 'util/rest'\nimport * as list from 'util/list'\nimport pageConfig from 'page-config'\nimport user from 'user-info'\nimport * as tmpl from 'util/tmpl'\n\ntmpl.verbatim()\n\nfunction setReplyTo (data) {\n    $('#comment-form input[name=reply_to]').remove()\n    $('<input>')\n        .attr({ type: 'hidden', name: 'reply_to', value: data.id })\n        .prependTo('#comment-form')\n    $('#comment-form textarea').attr('placeholder', `@${data.nickname}`)\n    $('#cancel-reply').removeClass('hidden-xs-up')\n    location.href = '#comment-title'\n}\n\nfunction clearReplyTo () {\n    $('#comment-form input[name=reply_to]').remove()\n    $('#cancel-reply').addClass('hidden-xs-up')\n    $('#comment-form textarea').attr('placeholder', ``)\n}\n\n$('#cancel-reply').click(clearReplyTo)\n\nconst $commentBox = $(\"#comment-box\")\n\nconst commentAPI = new API(`/api/articles/${pageConfig.articleId}/comments/`)\n\nlet commentList = new list.List({\n    $box: $commentBox,\n    api: commentAPI,\n    tmpl: 'comment-item',\n    $loadMore: '#load-more-comments'\n}).results(results => results.forEach(item => {\n    item.can_reply = user.authenticated && item.author.id !== user.userId\n}))\n\n$commentBox.on('click', '.btn-reply', function () {\n    setReplyTo($(this).data())\n})\n\nnew Form('#comment-form', commentAPI, 'post')\n    .submitted(response => {\n        response.ok(commentList.prepend.bind(commentList))\n            .ok(clearReplyTo)\n    })\n\n// Verification\n\n$('#accept, #reject').on('click', function () {\n    let action = $(this).attr('id')\n    new API(`/api/articles/${pageConfig.articleId}/${action}/`)\n        .post().ok(() => {\n            $(this).parent().remove()\n        })\n})\n\n$('#delete-article').click(() => {\n    if (confirm('Are you sure to delete?')) {\n        new API(`/api/articles/${pageConfig.articleId}/`).delete()\n            .ok(() => {\n                alert('OK')\n                location.href = '/articles/list/'\n            })\n    }\n})\n"]}