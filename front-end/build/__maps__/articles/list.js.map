{"version":3,"sources":["list.js"],"names":["tmpl","timeago","verbatim","getParams","url","window","location","href","match","plus","search","query","split","decode","decodeURIComponent","s","replace","result","exec","Router","_init","prototype","params","_eventBus","$","on","_fireRouteEvent","bind","first","pathname","trigger","go","title","history","pushState","route","cb","e","rest","router","$topNav","$sideNav","$sideNavItems","$tabContents","getTabId","name","id","articleListManager","_listViews","activeName","config","menus","apis","defaultName","_menus","_apis","_defaultName","_registerRouteEvents","_createMenus","_createListViews","tmplSuffix","data","items","navTmplId","prefix","pack","item","map","isArray","renderEachTo","click","preventDefault","_showTab","currentTarget","target","currentUrl","removeClass","$sideItem","addClass","sel","tab","each","api","ArticleListView","_currentAPI","_api","_name","_first","_$pane","renderTo","_registerPagerEvents","_load","param","currentParamString","get","ok","renderInto","article","getTmpl"],"mappings":"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","file":"../../articles/list.js","sourcesContent":["import 'bootstrap'\nimport Mustache from 'mustache'\nimport * as tmpl from 'util/tmpl'\nimport API from 'util/rest'\nimport * as timeago from 'timeago'\n\ntmpl.verbatim()\n\n// Helper Functions\n\nfunction getParams (url = window.location.href) {\n    let match\n    let plus = /\\+/g\n    let search = /([^&=]+)=?([^&]*)/g\n    let query = (url.split('?')[1] || '').split('#')[0]\n\n    const decode = s => decodeURIComponent(s.replace(plus, \" \"))\n\n    let result = {}\n    while (match = search.exec(query))\n        result[decode(match[1])] = decode(match[2])\n\n    return result\n}\n\n\n// `Router` Class Definition\n\nfunction Router () { this._init() }\n\nRouter.prototype = {\n\n    _init () {\n        this.url = ''\n        this.params = {}\n        this._eventBus = $({})\n        // Listen `popstate` event\n        $(window).on('popstate', this._fireRouteEvent.bind(this))\n        // Trigger event when page loaded\n        $(() => this._fireRouteEvent(true))\n    },\n\n    _fireRouteEvent (first = false) {\n        this.url = location.pathname\n        this.params = getParams()\n        this._eventBus.trigger('route', [this.url, this.params, first])\n    },\n\n    go (url, title = '', trigger = true) {\n        history.pushState(null, title, url)\n        if (trigger) this._fireRouteEvent()\n    },\n\n    route (cb) {\n        this._eventBus.on('route', (e, ...rest) => cb(...rest))\n        return this\n    }\n}\n\nconst router = new Router()\n\n// Page relevance\n\nconst $topNav = $('#article-top-nav'), $sideNav = $('#article-side-nav')\n\nlet $sideNavItems\n\nconst $tabContents = $('div.tab-content')\n\nconst getTabId = name => `tab-${name}`\nconst id = function () { return getTabId(this.name) }\n\nexport const articleListManager = {\n\n    _listViews: {},\n\n    activeName: '',\n\n    /**\n     *\n     * @param  {list} menus e.g. [['title1', 'name1'], ['title2',[['title3', 'name3']]]]\n     * @param  {flat dict} apis  {'name1': API1, 'name2': API2, 'name3': API3}\n     * @return {undefined}\n     */\n    config (menus, apis, defaultName = '') {\n        this._menus = menus\n        this._apis = apis\n        this._defaultName = defaultName\n        this._registerRouteEvents()\n        this._createMenus()\n        this._createListViews()\n    },\n\n    _createMenus () {\n        const tmplSuffix = data => data.items ? 'stacked' : 'single'\n        const navTmplId = prefix => data => `${prefix}-${tmplSuffix(data)}`\n        const pack = item => ({ name: item[1], title: item[0], id })\n\n        const menus = this._menus.map(item =>\n            $.isArray(item[1]) ? {\n                title: item[0],\n                items: item[1].map(pack)\n            } : pack(item)\n        )\n\n        tmpl.renderEachTo($topNav, navTmplId('article-top-nav'), menus)\n\n        tmpl.renderEachTo($sideNav, navTmplId('article-side-nav'), menus)\n\n        $sideNavItems = $('a', $sideNav)\n\n        $sideNavItems.click(e => {\n            e.preventDefault()\n            this._showTab($(e.currentTarget).data('name'))\n        })\n\n        $('a[data-name]').on('click', ({ target }) => {\n            let name = $(target).data('name')\n            router.go(this._listViews[name].currentUrl(), '')\n        })\n\n        $('a[data-name]', $topNav).click(({ target }) => {\n            let name = $(target).data('name')\n            $(`a`, $sideNav).removeClass('active')\n            let $sideItem = $(`a[data-name=${name}]`, $sideNav).addClass('active')\n        })\n    },\n\n    _registerRouteEvents () {\n        router.route((url, params, first) => {\n            let name = (/\\/list\\/(.+)\\/$/.exec(url) || '')[1] || this._defaultName\n            this.activeName = name\n            if (first) this._showTab(name)\n        })\n    },\n\n    _showTab (name) {\n        let sel = `a[data-name=${name}]`\n        $(sel, $topNav).tab('show')\n        $(`a`, $sideNav).removeClass('active')\n        let $sideItem = $(sel, $sideNav).addClass('active')\n    },\n\n    _createListViews () {\n        $.each(this._apis, (name, api) => {\n            this._listViews[name] = new ArticleListView(name, api)\n        })\n    }\n}\n\nfunction ArticleListView (name, api) {\n    this._currentAPI = this._api = (new API(api))\n    this._name = name\n    this._init()\n}\n\nArticleListView.prototype = {\n\n    _init () {\n        this._first = true\n        // Init tab panel\n        this._$pane = tmpl.renderTo($tabContents, 'tab-pane', {\n            name: this._name,\n            id\n        })\n        this._registerPagerEvents()\n        this._registerRouteEvents()\n    },\n\n    _registerRouteEvents () {\n        router\n            .route((url, params) => {\n                if (articleListManager.activeName !== this._name) return\n                if (this._first) this._load(this._api.param(params))\n            })\n    },\n\n    _registerPagerEvents () {\n        $(this._$pane).on('click', 'a.page-link', e => {\n            e.preventDefault()\n            let api = $(e.target).data('api')\n            this._load(api)\n            router.go(this.currentUrl(), '', false)\n        })\n    },\n\n    currentUrl () {\n        return `/articles/list/${this._name}/?${this._currentAPI.currentParamString()}`\n    },\n\n    _load (api) {\n        this._first = false\n        return (this._currentAPI = new API(api)).get().ok(data => {\n            tmpl.renderInto(this._$pane, 'article-list-view', data, { article: tmpl.getTmpl('article') })\n            timeago.bind()\n        })\n    }\n}\n"]}