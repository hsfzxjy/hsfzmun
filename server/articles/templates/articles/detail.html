{% extends "bases/base-with-header.html" %}

{% block content %}

{% verbatim %}
<template id="tmpl-comment-item">
    <li class="media my-4">
        <div class="media-body">
            {{#reply_to}}
            @{{reply_to.nickname}}
            {{/reply_to}}
            {{content}}
            <p>
                <small class="mt-1 mb-0">
                    {{author.nickname}}&middot;
                    <time class="timeago" datetime="{{posted}}"></time>
                    {{#can_reply}}
                    <button class="btn btn-link btn-sm btn-reply" data-id="{{author.id}}" data-nickname="{{author.nickname}}">Reply</button>
                    {{/can_reply}}
                </small>
            </p>
        </div>
    </li>
</template>
{% endverbatim %}

<div class="container-fluid">
    <article class="col-md-8 offset-md-2">
        <section>
            <h1 class="text-center">{{article.title}}</h1>
        </section>
        <section class="my-3">
            <span class="text-muted">
                {{article.author.nickname}} &middot;
                {% trans 'Publish at' %} <time class="timeago" datetime="{{article.published|date:'c'}}"></time> &middot;
                {% trans 'Edit at' %} <time class="timeago" datetime="{{article.published|date:'c'}}"></time>
            </span>
        </section>
        <section class="my-3">
            {% if perms.articles.can_verify  and article.author.id != user.id %}
            <div class="btn-group btn-group-sm">
                {% if article.status != 'rejected' %}
                <button class="btn btn-secondary btn-danger" id="reject">{% trans 'Reject' %}</button>
                {% endif %}
                {% if article.status != 'verified' %}
                <button class="btn btn-secondary btn-success" id="accept">{% trans 'Accept' %}</button>
                {% endif %}
            </div>
            {% endif %}
        </section>
        <section class="my-2">
            {{article.content|safe}}
        </section>
        <section class="my-2">
            {% for tag in article.tags.all %}
            <span class="badge badge-default">{{tag.name}}</span>
            {% endfor %}
        </section>
        <section class="my-5">
            <h6 id='comment-title'>{% trans 'Comment' %}</h6>
            <form class="clearfix" id="comment-form">
                <input type="hidden" name="author" value="{{user.id}}">
                <input type="hidden" name="article" value="{{article.id}}">
                <div class="form-group">
                    <textarea name="content" class="form-control"></textarea>
                </div>
                <div class="form-group clearfix">
                    <button type="submit" class="btn btn-primary float-right ml-2">{% trans 'Submit' %}</button>
                    <button type="button" class="btn btn-secondary ml-2 float-right hidden-xs-up" id="cancel-reply">{% trans 'Cancel Reply' %}</button>
                    <small class="text-muted float-right hidden-sm-down my-2">Ctrl + Enter</small>
                </div>
            </form>
        </section>
        <section>
            <ul class="list-unstyled" id="comment-box"></ul>
            <p id="load-more-comments">{% trans 'Load More' %}</p>
        </section>
    </article>
</div>

{% endblock %}

{% block scripts %}
<script>
    define('page-config', {
        articleId: {{article.id}}
    })
    require(['articles/detail'])
</script>
{% endblock %}
