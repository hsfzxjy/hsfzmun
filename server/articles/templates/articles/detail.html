{% extends "bases/base-with-header.html" %}

{% block content %}

<template id="tmpl-comment-item">
    <li class="media my-4">
        <img src="[[author.avatar_url]]" class="rounded-circle mr-3">
        <div class="media-body">
            [[#reply_to]]
            <small class="text-primary">{% trans 'Reply to' %} [[reply_to.nickname]]</small><br>
            [[/reply_to]]
            [[content]]
            <p class="text-muted">
                <small class="mt-1 mb-0">
                    <a href="[[author.url]]">[[author.nickname]]</a>&nbsp;&middot;
                    <time class="timeago" datetime="[[posted]]"></time>
                    [[#can_reply]]
                    <button class="btn btn-link btn-sm btn-reply" data-id="[[author.id]]" data-nickname="[[author.nickname]]">Reply</button>
                    [[/can_reply]]
                </small>
            </p>
        </div>
    </li>
</template>

<div class="container-fluid mt-3">
    <article class="col-md-8 offset-md-2">
        <section>
            <h1 class="text-center">{{article.title}}</h1>
        </section>
        <section class="my-3">
            {% if perms.articles.can_verify %}
            <div class="btn-group btn-group-sm">
                {% if article.status != 'rejected' %}
                <button class="btn btn-secondary btn-danger" id="reject">{% trans 'Reject' %}</button>
                {% endif %}
                {% if article.status != 'verified' %}
                <button class="btn btn-secondary btn-success" id="accept">{% trans 'Accept' %}</button>
                {% endif %}
            </div>
            {% endif %}
        </section>
        <section class="my-2">
            {{article.content|safe}}
        </section>
        <section class="my-3">
            <div class="text-right">
                {% has_perm 'articles:change_article' user article as can_change_article %}
                {% if can_change_article %}
                <a href="/articles/edit/{{article.id}}/">{% trans 'Edit' %}</a>
                <a href="javascript:void(0)" class="text-danger" id="delete-article">{% trans 'Delete' %}</a>
                {% endif %}
            </div>
            <p class="text-muted text-right">
                {{article.author.user_tag|safe}} &middot;
                {% trans 'Publish at' %} <time class="timeago" datetime="{{article.published|date:'c'}}"></time> &middot;
                {% trans 'Edit at' %} <time class="timeago" datetime="{{article.published|date:'c'}}"></time>
            </p>
        </section>
        <section class="my-2">
            {% for tag in article.tags.all %}
            <span class="badge badge-primary">{{tag.name}}</span>
            {% endfor %}
        </section>
        <section class="mt-3">
            <div class="list-group">
            {% for attachment in article.attachments.all %}
                <a href="{{attachment.file}}" class="list-group-item list-group-item-action" target="_blank">{{attachment.name}}</a>
            {% endfor %}
            </div>
        </section>
        <section class="my-5">
            <h6 id='comment-title'>{% trans 'Comment' %}</h6>
            <form class="clearfix" id="comment-form">
                <input type="hidden" name="author" value="{{user.id}}">
                <input type="hidden" name="article" value="{{article.id}}">
                <div class="form-group">
                    <textarea name="content" class="form-control"></textarea>
                </div>
                <div class="form-group clearfix">
                    {% if user.is_authenticated %}
                    <button type="submit" class="btn btn-primary float-right ml-2">{% trans 'Submit' %}</button>
                    <button type="button" class="btn btn-secondary ml-2 float-right hidden-xs-up" id="cancel-reply">{% trans 'Cancel Reply' %}</button>
                    {% else %}
                    <a href="/users/login/" class="btn btn-primary float-right">{% trans 'Login to comment' %}</a>
                    {% endif %}
                </div>
            </form>
        </section>
        <section>
            <ul class="list-unstyled" id="comment-box"></ul>
            <p id="load-more-comments" class="text-center bg-muted">{% trans 'Load More' %}</p>
        </section>
    </article>
</div>

{% endblock %}

{% block scripts %}
<script>
    define('page-config', {
        articleId: {{article.id}}
    })
    require(['articles/detail'])
</script>
{% endblock %}
